@inject IJSRuntime JsRuntime
@implements IAsyncDisposable
@inherits Input<string>

<textarea Placeholder="Введите текст" id="@EditorId"></textarea>

@code {
    private string EditorId { get; } = $"cke_{Guid.NewGuid()}";

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);
        if (firstRender)
        {
            await InitializeEditor();
        }
    }

    private ValueTask<string> InitializeEditor()
    {
        var arg = new {selector = $"{EditorId}", instance = DotNetObjectReference.Create(this), content = Value};
        return JsRuntime.InvokeAsync<string>(
            "BlazorCKE.init",
            arg);
    }

    [JSInvokable]
    public async Task<bool> UpdateText(string editorText)
    {
        CurrentValue = editorText;
        return true;
    }

    public ValueTask DisposeAsync()
    {
        var arg = new {selector = $"{EditorId}"};
        return JsRuntime.InvokeVoidAsync("BlazorCKE.destroy", arg);
    }

}
