@using BioEngine.Core.Data.Entities.Blocks
@inject IJSRuntime JsRuntime

<FormItem Label="Ссылка">
    <Input @bind-Value="@Block.Data.TweetLink" OnBlur="RenderTweetAsync"/>
</FormItem>
@if (!string.IsNullOrEmpty(Block.Data.TweetId))
{
    <div id="twitter-@Block.Id" class="tweet">Загрузка твита...</div>
}

@code
{
    [Parameter]
    public TwitterBlock Block { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);
        if (firstRender)
        {
            await RenderTweetAsync();
        }
    }
    
    private async Task RenderTweetAsync()
    {
        if (!string.IsNullOrEmpty(Block.Data.TweetId))
        {
            var arg = new {tweetId = Block.Data.TweetId, id = Block.Id, instance = DotNetObjectReference.Create(this)};
            await JsRuntime.InvokeAsync<string>(
                "BlazorTwttr.render",
                arg);
        }
    }
}
